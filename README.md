# Meteo request

Задача: получить метео данные для указанного города. 
Если город не указан, идёт запрос по адресу текущего ip.

## Используемые ресурсы:

Получить метео данные по указанному городу: [wttr.in](https://github.com/chubin/wttr.in)

Проверка существования города: 
[countriesnow.space/api/v0.1/countries/population/cities](https://documenter.getpostman.com/view/1134062/T1LJjU52)

Получить город по текущему ip: 
[ipapi.co/json](https://ipapi.co/api/#location-of-clients-ip)


## План

Пользователь вызывает программу, указывая город, по которому хочет получить метео данные:

```text
go run . --city="Moskva"
```

Можно не указывать город. В этом случае запрос будет осуществлён по адресу ip, 
с которого осуществляется запрос. Т.е.

```text
go run .
```

Если пользователь ввёл наименование города, проверяем его существование (ресурс `countriesnow.space`). 
Добиваемся верного ввода. 

Если пользователь вообще не вводил наименование города, 
определяем его город его расположения (ресурс `ipapi.co`). 

Теперь, когда имеем наименование города, можем получить прогноз погоды (ресурс `wttr.in`)

## Реализация

Запрос на `countriesnow.space` судя по документации, должен быть в post формате. 
Возвращает данные о городе. 
Одним из полей является error. 
Если его значение false, значит город существует. 
По сути, нам по задаче нужна лишь информация о факте существования города.  
Поэтому, когда будем разбирать ответ от сервера, 
создадим промежуточную структуру, которая будет извлекать лишь поле error.

Из интересных моментов можно отметить передачу в пост-запрос третьего аргумента. 
Это должен быть интерфейс, совместимый с io.Reader, который содержит байты. 
Поэтому, сначала создаём мапу и передаём её в json.Marshal, конвертируя её в блок байт. 
Затем, передаём созданный блок байт в bytes.NewBuffer, который совместим с io.Reader:

```golang
blockBytes, _ := json.Marshal(map[string]string{"city": inCity});

resp, _ := http.Post(
  "https://countriesnow.space/api/v0.1/countries/population/cities",
  "application/json",
  bytes.NewBuffer(blockBytes),
)
```

Интересный момент: запрос по городу Moscow даст отрицательный ответ. 
В то время, как запрос на Moskva - положительный. 
Это нужно учитывать при тестировании работы программы

---

При запросе на `https://ipapi.co/{format}` нужно будет получить данные в формате json, 
а из них понадобится лишь поле city. 
Запрос Get, в общих чертах повторяет Post запрос. 
Лишь не нужно передавать никаких дополнительных данных 

---

Запрос по погоде на `https://wttr.in/{city}` тоже имеет тип Get. 
Отправим его, сформировав дополнительные данные посредством мапы url.Values{}.